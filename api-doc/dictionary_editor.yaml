swagger: '2.0'

# This is your document metadata
info:
  version: "0.1.0"
  title: IEML Library API
  description : API for both the IEML dictionary and the IEML library

basePath : /dictionary_api
produces :
  - application/json
paths:

  ##############################
  ## FOR THE DICTIONARY'S API ##
  ##############################

  /allieml:
    get:
      operationId: handlers.all_ieml
      tags:
        - IEML
      description: |
        Returns a list of all the `IEML term` objects.
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/ieml_term'

  /get_term:
    get:
      operationId: handlers.get_term
      tags:
        - IEML
      description: |
        Return a specific term object.
      parameters:
        - name: script
          in: query
          type: string
          required: true
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/ieml_term'

  /client/authenticate:
    post:
      operationId: handlers.authenticate
      description: |
        Login handler for the dictionary user
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: name
          in: formData
          type: string
          required: true
        - name: password
          in: formData
          type: string
          required: true
      responses:
        '200':
          description: Successful response

  /scriptparser/parse:
    get:
      operationId: handlers.parse_ieml
      tags:
        - Parsing
      description: |
        Checks the validity of `IEML term`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML term` for which we want to get the computed tree.
          type: string
          required: true
      responses:
        '200':
          description: Successful response
          schema:
            title: Parsed term
            type: object
            required:
              - success
            properties:
              factorization:
                type: string
              level:
                type : integer
              taille:
                type : integer
              class:
                type: integer
              success  :
                type: boolean
              canonical:
                type: array
                items:
                  type : string
              rootIntersections:
                type: array
                items:
                  type: string
              containsSize:
                type: integer

  /scriptparser/tables:
    get:
      operationId: handlers.script_table
      tags:
        - Parsing
      description: |
        Compute the tables for an `IEML paradigm`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML paradigm` for which we want to get the computed table.
          type: string
          required: true
      responses:
        '200':
          description: Successful response
          schema:
            type: object
            properties:
              success:
                type: boolean
              tree:
                type: object
                properties:
                  Tables:
                    type: array
                    items:
                      type: object
                  input:
                    type: string

  /scriptparser/tree:
    get:
      operationId: handlers.script_tree
      tags:
        - Parsing
      description: |
        Computes the tree of a given `IEML term`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML term` for which we want to get the computed tree.
          type: string
          required: true
      responses:
        '200':
          description: Successful response

  /getRelVisibility:
    post:
      operationId: handlers.get_relation_visibility
      description: |
        TODO
      parameters:
        - name: body
          in: body
          required: True
          schema:
            type: object
            properties:
              ieml:
                type: string
      responses:
        '200':
          description: Successful response

  /rels:
    post:
      operationId: handlers.get_relations
      tags:
        - Relations
      description: >
        Returns a list of all the relations associated with the `IEML term`
        given in the payload
      parameters:
        - name: body
          in: body
          description: >
            The `IEML term` for which we want to get its associated
            relationships.
          required: true
          schema:
            type: object
            properties:
              ieml:
                type: string
              factorize_descendant:
                type: boolean
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              type: object
              properties:
                rellist:
                  type: array
                  items:
                    type: object
                    properties:
                      _id:
                        type: string
                      exists:
                        type: boolean
                      ieml:
                        type: string
                      start:
                        type: string
                      visible:
                        type: boolean
                reltype:
                  type: string
                visible:
                  type: boolean
  /newieml:
    post:
      operationId: handlers.new_ieml_script
      description: |
        Add a new `IEML` term to the dictionary
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - IEML
              - PARADIGM
              - token
            properties:
              IEML:
                type : string
              PARADIGM:
                type : string
              token :
                type : string
              INHIBITS :
                type : array
                items :
                  type : string
      responses:
        '200':
          description: Successful response
  /updateieml:
    post:
      operationId: handlers.update_ieml_script
      description: |
        Modify an `IEML` term from the dictionary
      parameters:
        - name : body
          in: body
          required : true
          schema:
            type : object
            required:
              - ID
              - token
            properties:
              ID :
                type : string
              PARADIGM :
                type : string
              IEML :
                type : string
              FR :
                type : string
              EN :
                type : string
              token :
                type : string
              INHIBITS :
                type : array
                items :
                  type : string
      responses:
        '200':
          description: Successful response

  /update_status:
    get:
      operationId: handlers.computation_status
      description: |
        Get the status of the computation.
      responses:
        '200':
          description: Successful response

  /remieml:
    post:
      operationId: handlers.remove_ieml_script
      description: |
        Delete an `IEML` term from the dictionary
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - id
              - token
            properties:
              id:
                type : string
              token:
                type : string
      responses:
        '200':
          description: Successful response
  '/updaterelations':
    post:
      operationId: handlers.update_relations
      description: |
        Recompute the relations in the dictionary. This operation may take a long time (~2min).
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - token
            properties:
              token:
                type : string
      responses:
        '200':
          description: Successful response

  '/exists/ieml/{ieml_term}':
    get:
      operationId: handlers.ieml_term_exists
      description: |
        Check if `<term_ieml>` exists in the dictionary
      parameters:
        - in: path
          name: ieml_term
          required: true
          type: string
      responses:
        '200':
          description: Successful response
  '/exists/FR/{tag_fr}':
    get:
      operationId: handlers.fr_tag_exists
      description: |
        Check if `<term_ieml>` exists in the **French** dictionary
      parameters:
        - in: path
          name: tag_fr
          required: true
          type: string
      responses:
        '200':
          description: Successful response
  '/exists/EN/{tag_en}':
    get:
      operationId: handlers.en_tag_exists
      description: |
        Check if `<term_ieml>` exists in the **English** dictionary
      parameters:
        - in: path
          name: tag_en
          required: true
          type: string
      responses:
        '200':
          description: Successful response

  /ranking:
    get:
      operationId: handlers.get_terms_ranking
      parameters:
        - in: path
          name: ieml
          required: true
          type: string
      responses:
        '200':
          description: Successful response


  ##############################
  ## FOR THE DICTIONARY'S API ##
  ##############################

  /client/authenticate:
    post:
      tags:
        - Dictionary
      operationId: handlers.authenticate
      description: |
        Login handler for the dictionary user
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: name
          in: formData
          type: string
          required: true
        - name: password
          in: formData
          type: string
          required: true
      responses:
        '200':
          description: Successful response

  ##############################
  ## FOR THE DICTIONARY'S API ##
  ##############################
definitions:
  ieml_term:
    properties:
      CANONICAL:
        type: array
        items:
          type: string
      CLASS:
        type: number
      EN:
        type: string
      FR:
        type: string
      IEML:
        type: string
      LAYER:
        type: number
      PARADIGM:
        type: number
      ROOT_PARADIGM:
        type: boolean
      TAILLE:
        type: number
      _id:
        type: string
