swagger: '2.0'

# This is your document metadata
info:
  version: "0.1.0"
  title: IEML Library API
  description : API for both the IEML dictionary and the IEML library

basePath : /api
produces : 
  - application/json
paths:

  ##############################
  ##          INTLEKT         ##
  ##############################

  /intlekt/push:
    post:
      operationId: handlers.push_server_event
      tags:
        - Intlekt
      parameters:
        - name: screen_name
          in: query
          description: The twitter screen_name of the user we wish to notify of the event
          type: string
          required: true
        - name: event_data
          in: body
          description: |
            A description of the event
          required: true
          schema:
            type: object
      description: |
        Push asynchronous server event to the client
      responses:
        '200':
          description: |
            Everything went well

  /intlekt/collections/draft:
    post:
      operationId: handlers.createCollectionDraft
      tags:
        - Intlekt
      parameters:
        - name: collectionParams
          in: body
          description: |
            A description of the starting parameters of a new collection
          required: true
          schema:
            type: object
      description: |
        Ask the server to create a new collection for us
      responses:
        '200':
          description: |
            The request has been accepted

  /intlekt/collections/{collection_id}/dataset:
    get:
      operationId: handlers.getPreTaggedDataset
      tags:
        - Intlekt
      parameters:
        - name: collection_id
          in: path
          description: |
            The id of the collection
          required: true
          type: string
          description: |
            Return the collection of Tagged Resources associated with a collection. If no
            Resources currently exist, a request will be made to retrieve them
      responses:
        '200':
          description: |
            The tagged resources associated with the requested collection

  /intlekt/test:
    get:
      operationId: handlers.test_endpoint
      tags:
        - Intlekt
      description: |
        A wildcard endpoint for testing purposes
      responses:
        '200':
          description: |
            Some message

  /intlekt/auth/logout:
    get:
      operationId: handlers.logout
      tags:
        - Intlekt
      description: |
        log out
      responses:
        '200':
          description: |
            json formatted success message

  /intlekt/auth/info:
    get:
      operationId: handlers.info
      tags:
        - Intlekt
      description: |
        get info about the currently logged-in user
      responses:
        '200':
          description: |
            info about the currently logged-in user

  /intlekt/twitter/token:
    get:
      operationId: handlers.twitter_token
      tags:
        - Intlekt
      description: |
        Initiate the oauth dance
      responses:
        '302':
          description: |
            redirect the user's browser to Twitter's authorization page

  /intlekt/twitter/upgradeToken:
    get:
      operationId: handlers.twitter_upgradeToken
      tags:
        - Intlekt
      description: |
        retrieve the token
      responses:
        '302':
          description: redirect the our home screen

  /intlekt/twitter/home_timeline:
    get:
      operationId: handlers.twitter_home_timeline
      tags:
        - Intlekt
      description: |
        Generate a visualization for the user's home timeline
      responses:
        '200':
          description: |
            a series of coordinates adequate for a specific type of visualization

  /intlekt/twitter/update:
    get:
      operationId: handlers.twitter_update
      tags:
        - Intlekt
      description: |
        Request an update of the user's twitter feed
      responses:
        '200':
          description: |
            a series of coordinates adequate for a specific type of visualization

  /intlekt/twitter/similarities:
    get:
      operationId: handlers.twitter_similarities
      tags:
        - Intlekt
      description: |
        Request a similarity computation on the user's home timeline
      responses:
        '200':
          description: |
            a list of resources ranked by similarity

  ##############################
  ## FOR THE DICTIONARY'S API ##
  ##############################

  /allieml:
    get:
      operationId: handlers.all_ieml
      tags:
        - IEML
      description: |
        Returns a list of all the `IEML term` objects.
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/ieml_term'

  /client/authenticate:
    post:
      operationId: handlers.authenticate
      description: |
        Login handler for the dictionary user
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: name
          in: formData
          type: string
          required: true
        - name: password
          in: formData
          type: string
          required: true
      responses:
        '200':
          description: Successful response

  /scriptparser/parse:
    get:
      operationId: handlers.parse_ieml
      tags:
        - Parsing
      description: |
        Checks the validity of `IEML term`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML term` for which we want to get the computed tree.
          type: string
          required: true
      responses:
        '200':
          description: Successful response
          schema:
            title: Parsed term
            type: object
            required:
              - success
            properties:
              level:
                type : integer
              taille:
                type : integer
              class:
                type: integer
              success  :
                type: boolean
              canonical:
                type: array
                items:
                  type : string

  /scriptparser/tables:
    get:
      operationId: handlers.script_table
      tags:
        - Parsing
      description: |
        Compute the tables for an `IEML paradigm`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML paradigm` for which we want to get the computed table.
          type: string
          required: true
      responses:
        '200':
          description: Successful response
          schema:
            type: object
            properties:
              success:
                type: boolean
              tree:
                type: object
                properties:
                  Tables:
                    type: array
                    items:
                      type: object
                  input:
                    type: string

  /scriptparser/tree:
    get:
      operationId: handlers.script_tree
      tags:
        - Parsing
      description: |
        Computes the tree of a given `IEML term`
      parameters:
        - name: iemltext
          in: query
          description: The `IEML term` for which we want to get the computed tree.
          type: string
          required: true
      responses:
        '200':
          description: Successful response

  /getRelVisibility:
    post:
      operationId: handlers.get_relation_visibility
      description: |
        TODO
      parameters:
        - name: body
          in: body
          required: True
          schema:
            type: object
            properties:
              ieml:
                type: string
      responses:
        '200':
          description: Successful response

#  /addRelVisibility:
#    post:
#      operationId: handlers.add_relation_visiblity
#      description: Inhibits relations of a paradigm
#      parameters:
#        - name: body
#          in: body
#          required: True
#          schema:
#            type: object
#            properties:
#              ieml:
#                type: string
#              relations:
#                type : array
#                items:
#                  type : string
#              token :
#                type : string
#
#      responses:
#        '200':
#          description: Successful response
#  /remRelVisibility:
#    post:
#      operationId: handlers.remove_relation_visibility
#      description: |
#        TODO
#      parameters:
#        - name: body
#          in: body
#          required: True
#          schema:
#            type: object
#            properties:
#              ieml:
#                type: string
#              token:
#                type: string
#
#      responses:
#        '200':
#          description: Successful response
  /rels:
    post:
      operationId: handlers.get_relations
      tags:
        - Relations
      description: >
        Returns a list of all the relations associated with the `IEML term`
        given in the payload
      parameters:
        - name: term
          in: body
          description: >
            The `IEML term` for which we want to get its associated
            relationships.
          required: true
          schema:
            type: object
            properties:
              ieml:
                type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              type: object
              properties:
                rellist:
                  type: array
                  items:
                    type: object
                    properties:
                      _id:
                        type: string
                      exists:
                        type: boolean
                      ieml:
                        type: string
                      start:
                        type: string
                      visible:
                        type: boolean
                reltype:
                  type: string
                visible:
                  type: boolean
  /newieml:
    post:
      operationId: handlers.new_ieml_script
      description: |
        Add a new `IEML` term to the dictionary
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - IEML
              - PARADIGM
              - token
            properties:
              IEML:
                type : string
              PARADIGM:
                type : string
              token :
                type : string
              INHIBITS :
                type : array
                items :
                  type : string
      responses:
        '200':
          description: Successful response
  /updateieml:
    post:
      operationId: handlers.update_ieml_script
      description: |
        Modify an `IEML` term from the dictionary
      parameters:
        - name : body
          in: body
          required : true
          schema:
            type : object
            required:
              - ID
              - token
            properties:
              ID :
                type : string
              PARADIGM :
                type : string
              IEML :
                type : string
              FR :
                type : string
              EN :
                type : string
              token :
                type : string
              INHIBITS :
                type : array
                items :
                  type : string
      responses:
        '200':
          description: Successful response
  '/remieml':
    post:
      operationId: handlers.remove_ieml_script
      description: |
        Delete an `IEML` term from the dictionary
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - id
              - token
            properties:
              id:
                type : string
              token:
                type : string
      responses:
        '200':
          description: Successful response
  '/updaterelations':
    post:
      operationId: handlers.update_relations
      description: |
        Recompute the relations in the dictionary. This operation may take a long time (~2min).
      parameters:
        - in : body
          name : body
          required : true
          schema :
            type: object
            required:
              - token
            properties:
              token:
                type : string
      responses:
        '200':
          description: Successful response
  '/exists/ieml/{ieml_term}':
    get:
      operationId: handlers.ieml_term_exists
      description: |
        Check if `<term_ieml>` exists in the dictionary
      parameters:
        - in: path
          name: ieml_term
          required: true
          type: string
      responses:
        '200':
          description: Successful response
  '/exists/FR/{tag_fr}':
    get:
      operationId: handlers.fr_tag_exists
      description: |
        Check if `<term_ieml>` exists in the **French** dictionary
      parameters:
        - in: path
          name: tag_fr
          required: true
          type: string
      responses:
        '200':
          description: Successful response
  '/exists/EN/{tag_en}':
    get:
      operationId: handlers.en_tag_exists
      description: |
        Check if `<term_ieml>` exists in the **English** dictionary
      parameters:
        - in: path
          name: tag_en
          required: true
          type: string
      responses:
        '200':
          description: Successful response

  #################################
  ## FOR THE USL/PROPOSITION API ##
  #################################

  /search:
    post:
      description: Search for propositions or  USLs in the library's database
      operationId: handlers.search_library
      parameters:
        - name: query
          in: body
          description: Search filters
          required: true
          schema:
            $ref: '#/definitions/search_filters'
      responses:
        200:
          description: Successful response
          schema:
            title: ArrayOfIEMLELements
            type: array
            items:
              $ref: '#/definitions/ieml_element'
              
  /tags/check_exists:
    post:
      description: Checks if a tag already exists for a proposition or an hypertext
      operationId: handlers.check_library_tag_exists
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: tag
          in: query
          description: Value of tested tag
          required: true
          type: string
        - name: language
          in: query
          description: Language of tag
          required: true
          type: string
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/tag_exists'
            
  /word/validate:
    post:
      operationId: handlers.validate_word
      tags:
        - Propositions
      description: Checks if a created word is good or not
      parameters:
        - name: body
          in: body
          description: Search filters
          required: true
          schema:
            $ref: '#/definitions/word_data'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
          
  /word/save:
    post:
      operationId: handlers.save_word
      tags:
        - Propositions
      description: Checks if a created word is good or not, and if good, saves it to the DB
      parameters:
        - name: body
          in: body
          description: Search filters
          required: true
          schema:
            $ref: '#/definitions/word_data'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
  
  /tree/validate:
    post:
      operationId: handlers.validate_tree
      tags:
        - Propositions
      description: Checks if a created sentence/super sentence graph is good or not, and if good, saves it to the DB
      parameters:
        - name: body
          in: body
          description: Search filters
          required: true
          schema:
            $ref: '#/definitions/proposition_graph'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
  
  /tree/save:
    post:
      operationId: handlers.save_tree
      tags:
        - Propositions
      description: Checks if a created sentence/super sentence graph is good or not, and if good, saves it to the DB
      parameters:
        - name: body
          in: body
          description: Search filters
          required: true
          schema:
            $ref: '#/definitions/proposition_graph'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
            
  /text/validate:
    post:
      operationId: handlers.validate_text
      tags:
        - USL
      description: Checks if a text is good or not,  and if good, saves it to the DB.
      parameters:
        - name: body
          in: body
          description: Text JSON data
          required: true
          schema:
            $ref: '#/definitions/text_data'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
  
  /hypertext/validate:
    post:
      operationId: handlers.validate_hypertext
      tags:
        - USL
      description: Checks if an hypertext graph is good or not, and if good saves it to the DB
      parameters:
        - name: body
          in: body
          description: Hypertext's graph json data
          required: true
          schema:
            $ref: '#/definitions/hypertext_graph'
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/validate_response'
            
  /text/decompose:
    post:
      operationId: handlers.decompose_text
      tags:
        - USL
      description: |
        Decomposes a text into a list of proposition tree, which details all the closed propositions contained in a proposition, along with their tags and the path need to reach them.
      parameters:
        - name: ieml_string
          in: query
          description: An IEML text's string value
          required: true
          type: string
      responses:
        200:
          description: Successful response
          schema:
            type : array
            items:
              $ref: '#/definitions/proposition_tree'
              
  /element/decompose:
    post:
      operationId: handlers.decompose_ieml_element
      description: Decomposes any IEML element to its children element (eg, a text into propositions, a sentence into a tree of words, or a word into two lists of terms)
      parameters:
        - name: ieml_string
          in: query
          description: An IEML element's string value
          required: true
          type : string
      responses:
        200:
          description: Successful response
          schema:
            type : array
            items:
              $ref: '#/definitions/decomposed_ieml_element'


  ##############################
  ## FOR THE
  ##############################

  /distance/usls:
    post:
      operationId: handlers.distance_usl_group
      description: Compute the distance between the usl in argument.
      parameters:
        - name: body
          in: body
          description: A list of usl
          required: true
          schema:
#            type: object
#            properties:
#              usls:
            type: array
            items:
              type: string
      responses:
        200:
          description: Successful response
          schema:
            $ref: '#/definitions/distance_group'

definitions:

  distance_group:
    properties:
      usls:
        type: array
        items:
          type: string
      distances:
        type: array
        items:
          type: array
          items:
            type: number


  ##############################
  ## FOR THE DICTIONARY'S API ##
  ##############################

  ieml_term:
    properties:
      CANONICAL:
        type: array
        items:
          type: string
      CLASS:
        type: number
      EN:
        type: string
      FR:
        type: string
      IEML:
        type: string
      LAYER:
        type: number
      PARADIGM:
        type: number
      ROOT_PARADIGM:
        type: boolean
      TAILLE:
        type: number
      _id:
        type: string


  #################################
  ## FOR THE USL/PROPOSITION API ##
  #################################
  search_filters:
    type: object
    required :
      - search_string
    properties:
      search_string:
        type : string
      language:
        type : string
      level:
        type: array
        items:
          type: string
      category:
        type: string
      term_type:
        type : string
    
  ieml_element:
    type: object
    required:
      - IEML
      - TAGS
      - TYPE
    properties:
      IEML: 
        type : string
      TAGS:
        type : string
      TYPE:
        type : string
        
  tag_exists:
    type: object
    properties:
      exist: 
        type: boolean
    
  tags:
    type : object
    required:
      - FR
      - EN
    properties:
      FR:
        type : string
      EN:
        type : string
  
  word_data:
    type: object
    required:
      - substance
      - mode
      - tags
    properties:
      substance:
        type : array
        items :
          type: string
      mode:
        type : array
        items :
          type: string
      tags:
        $ref: "#/definitions/tags"
      
  node:
    type: object
    required:
      - ieml_string
      - id
    properties:
      ieml_string:
        type : string
      id :
        type : string
  
  proposition_graph:
    type : object
    required:
      - nodes
      - graph
      - tags
    properties:
      nodes:
        type : array
        items:
          $ref: "#/definitions/node"
      graph:
        type: array
        items:
          type: object
          required:
            - substance
            - attribut
            - mode
          properties:
            substance :
              type : string
            attribut :
              type : string
            mode :
              type : string
      tags:
        $ref: "#/definitions/tags"
      validation_type:
        type : integer
    
  text_data:
    type: object
    required:
      - text
      - tags
    properties:
      text:
        type : array
        items :
          type: string
      tags:
        $ref: "#/definitions/tags"
  
  hyperlink_data:
    type: object
    required:
      - literal
      - selection
    properties:
      literal:
        type: string
      selection:
        type : array
        items:
          type : string
  
  hypertext_graph:
    type : object
    required:
      - nodes
      - graph
      - tags
    properties:
      nodes:
        type : array
        items:
          $ref: "#/definitions/node"
      graph:
        type: array
        items:
          type: object
          required:
            - substance
            - attribut
            - mode
          properties:
            substance :
              type : string
            attribut :
              type : string
            mode :
              $ref: "#/definitions/hyperlink_data"
              
      tags:
        $ref: "#/definitions/tags"
      validation_type:
        type : integer
  
  validate_response :
    type : object
    required:
      - valid
      - ieml
    properties:
      valid :
        type : boolean
      ieml:
        type : string
  
  proposition_tree:
    type: object
    required :
      - id
      - name
      - data
      - children
    properties:
      id :
        type: string
      name:
        type: string
      data :
        type: object
        required : 
          - PATH
          - TAGS
          - TYPE
        properties:
          PATH:
            type: array
            items:
              type : string
          TAGS:
            $ref: "#/definitions/tags"
          TYPE : 
            type: string
      children:
        type : array
        items:
          $ref: "#/definitions/proposition_tree"
  
  proposition_data:
    type : object
    required:
      - IEML
      - TAGS
      - TYPE
    properties:
          IEML:
            type: string
          TAGS:
            $ref: "#/definitions/tags"
          TYPE : 
            type: string
  
  decomposed_ieml_element:
    type: object
    properties:
    
      word_data: 
        type: object
        required :
          - substance
          - mode
        properties:
          substance:
            type: array
            items:
              $ref: "#/definitions/proposition_data"
          mode:
            type: array
            items:
              $ref: "#/definitions/proposition_data"
      
      sentence_data:
        type : array
        items:
          type : object
          required :
            - substance
            - attribute
            - mode
          properties:
            substance:
              $ref: "#/definitions/proposition_data"
            attribute:
              $ref: "#/definitions/proposition_data"
            mode:
              $ref: "#/definitions/proposition_data"
      
      text_data:
        type: array
        items :
          $ref: "#/definitions/proposition_data"
      
      hypertext_data:
        type: array
        items:
          type: object
          required:
            - substance
            - attribute
            - mode
          properties:
            substance: 
              type: string
            attribute : 
              type: string
            mode :
              type: object
              required:
                - literal
                - path
              properties:
                literal:
                  type: string
                path:
                  type: array
                  items:
                    type : string
        